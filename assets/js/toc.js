const SCROLL_OFFSET=150;document.addEventListener("DOMContentLoaded",()=>{function t(){const t=window.pageYOffset/(document.documentElement.scrollHeight-window.innerHeight),e=document.getElementById("toc"),n=e.scrollHeight,o=Math.min(t*n,n);e.style.setProperty("--progress-height",`${o}px`)}const e=document.getElementById("toc"),n=document.querySelector(".post-content");if(!e||!n)return;const o=n.querySelectorAll("h1, h2");if(0===o.length)return void(e.style.display="none");const c=document.createElement("h4");c.textContent="Contents",e.appendChild(c);const i=document.createElement("ul");o.forEach((t,e)=>{if(!t.id){const n=t.textContent.trim().toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");t.id=n||`section-${e}`}const n=document.createElement("li"),o=document.createElement("a");o.href=`#${t.id}`,o.textContent=t.textContent,o.setAttribute("data-heading-id",t.id),"H2"===t.tagName&&n.classList.add("toc-h2"),n.appendChild(o),i.appendChild(n)}),e.appendChild(i);const r=document.querySelectorAll("#toc a");let a=null;const s=new IntersectionObserver(t=>{let e=null,n=1/0;if(t.forEach(t=>{if(t.isIntersecting){const o=t.target.getBoundingClientRect();o.top<n&&(n=o.top,e=t)}}),e){const t=e.target.getAttribute("id"),n=document.querySelector(`#toc a[data-heading-id="${t}"]`);n&&n!==a&&(a&&(a.classList.remove("active"),a.removeAttribute("aria-current")),n.classList.add("active"),n.setAttribute("aria-current","location"),a=n)}},{rootMargin:"-20% 0% -70% 0%",threshold:0});o.forEach(t=>s.observe(t)),r.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("data-heading-id"),o=document.getElementById(n);if(o){const e=o.getBoundingClientRect().top+window.pageYOffset-SCROLL_OFFSET;o.classList.add("toc-highlight"),setTimeout(()=>{o.classList.remove("toc-highlight")},1e3),window.scrollTo({top:e,behavior:"smooth"}),a&&(a.classList.remove("active"),a.removeAttribute("aria-current")),t.classList.add("active"),t.setAttribute("aria-current","location"),a=t}})});const d=o[0];if(d){const t=document.querySelector(`#toc a[data-heading-id="${d.id}"]`);t&&(t.classList.add("active"),t.setAttribute("aria-current","location"),a=t)}window.addEventListener("scroll",t),t()});